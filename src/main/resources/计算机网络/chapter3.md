### 运输层

> 运输层协议为运行在不同主机上的应用程序提供 ***逻辑通信*** 服务， 同时运输层协议是运行在端系统中
> 而不是在路由器中实现的，因特网传输层协议包含TCP和UDP

在发送端，运输层将从发送应用程序进程接收到的报文转换为运输层分组，称之为运输层报文段

运输层之下是网络层， 网络层协议为IP协议，而网络层协议提供了主机之间的逻辑通信服务。
IP服务模型为 ***尽力而为的交付服务***， 它不保证报文段的交付，按序交付，数据完整性等，因此被称为不可靠服务。

将主机之间的交付扩展到应用进程间的的交付被称为运输层的多路复用与多路分解


### TCP

1. 可靠数据传输， 通过流量控制，序号， 确认和定时器实现。
2. 拥塞控制， 通过抑制发送段发送速度

### 多路分解与复用
1. 无连接的多路分解与复用
一个UDP套接字是由目的ip和目的端口全面标识的，意味着不同源ip或源端口，但目的IP和端口相同的报文会被
定向到相同应用程序的套接字

2. 面向连接的多路分解与复用
TCP套接字是由源IP，源端口，目的IP， 目的端口来标识的


### UDP报文段结构
UDP首部有四个字段：源端口号， 目的端口号，长度， 检验和
UDP应用数据


### 可靠数据传输原理
肯定确认和否定确认，在计算机网络中，基于重传机制的可靠数据传输协议称为自动重传请求(ARQ: Auto Repeat reQuest)

ARQ协议需要三种协议来处理比特差错的情况：差错检测，接收方反馈（ack,nak),重传


GBN(Go Back N)和SR(选择重传）


TCP提供了流量控制服务和拥塞控制
流量控制是指使发送发的发送速率与接收方的接受速率相匹配，以消除接收方缓存溢出的可能性。
拥塞控制是指网络拥塞超时时，抑制发送方来缓解网络拥堵情况


TCP通过发送方维护的接收窗口来提供流量控制。

TCP连接管理
连接建立过程：
1. 客户端发送一个特殊的TCP报文，该报文不含应用层数据，但报文首部字段SYN比特被置位1，
因此该特殊报文段又被称为SYN报文段。另外，客户会随机选择一个初始化序号client_sin放置于该报文段的
序号字段
2. 服务端收到SYN报文段，则为该TCP连接分配缓存和变量，并向客户端发送允许连接的报文，该报文
也不含应用数据，SYN比特被置位1， 确认序号为client_sin + 1, 随机选择自己的初始化序号server_sin。该报
文又被称为SYNACK报文段
3.客户端收到SYNACK报文段后， 为该连接分配缓存和变量，然后向服务端发送另一个报文：SYN比特被置位0，
确认序号为server_sin + 1, 该报文可以包含应用数据

经过以上三次握手后，连接建立，后续的报文SYN比特都为0


